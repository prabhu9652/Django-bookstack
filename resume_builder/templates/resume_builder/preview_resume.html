{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container" style="padding: var(--space-6) 0;">
  <!-- Header Actions -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-6); flex-wrap: wrap; gap: var(--space-4);">
    <div>
      <h1 style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--text-primary);">Resume Preview</h1>
      <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">{{ resume.title }}</p>
    </div>
    <div style="display: flex; gap: var(--space-3);">
      <a href="{% url 'resume_builder:edit_resume' resume.id %}" class="btn btn-secondary"><i class="fas fa-edit"></i> Edit</a>
      <a href="{% url 'resume_builder:download_resume' resume.id %}" class="btn btn-primary"><i class="fas fa-download"></i> Download</a>
      <button onclick="window.print()" class="btn btn-ghost"><i class="fas fa-print"></i> Print</button>
    </div>
  </div>

  <!-- Resume Preview -->
  <div class="resume-preview-wrapper">
    <div class="resume-paper" id="resumeContent" style="--primary-color: {{ resume.primary_color|default:'#4a9d9a' }};">
      
      <!-- HEADER with Photo -->
      <header class="resume-header">
        <div class="header-photo">
          {% if resume.profile_photo %}
            <img src="{{ resume.profile_photo.url }}" alt="{{ resume.full_name }}">
          {% else %}
            <div class="photo-placeholder"><i class="fas fa-user"></i></div>
          {% endif %}
        </div>
        <div class="header-info">
          <h1 class="header-name">{{ resume.full_name|upper }}</h1>
          <p class="header-role">{{ resume.role_title|default:resume.get_role_display }}</p>
          <div class="header-contact">
            {% if resume.email %}<div class="contact-item"><i class="fas fa-envelope"></i> {{ resume.email }}</div>{% endif %}
            {% if resume.phone %}<div class="contact-item"><i class="fas fa-phone"></i> {{ resume.phone }}</div>{% endif %}
            {% if resume.address %}<div class="contact-item"><i class="fas fa-home"></i> {{ resume.address }}</div>{% endif %}
            {% if resume.linkedin %}<div class="contact-item"><i class="fab fa-linkedin"></i> {{ resume.linkedin }}</div>{% endif %}
            {% if resume.github %}<div class="contact-item"><i class="fab fa-github"></i> {{ resume.github }}</div>{% endif %}
          </div>
        </div>
      </header>

      <!-- TWO COLUMN LAYOUT -->
      <div class="resume-body">
        <!-- LEFT SIDEBAR - Skills -->
        <aside class="resume-sidebar">
          <section class="sidebar-section">
            <h2 class="sidebar-heading">SKILLS</h2>
            <ul class="skills-list">
              {% for skill in resume.skills %}
                <li>{{ skill }}</li>
              {% endfor %}
            </ul>
          </section>
          
          {% if resume.languages %}
          <section class="sidebar-section">
            <h2 class="sidebar-heading">LANGUAGES</h2>
            <ul class="skills-list">
              {% for lang in resume.languages %}
                <li>{{ lang }}</li>
              {% endfor %}
            </ul>
          </section>
          {% endif %}
          
          {% if resume.education %}
          <section class="sidebar-section">
            <h2 class="sidebar-heading">EDUCATION</h2>
            {% for edu in resume.education %}
              <div class="edu-item">
                <div class="edu-degree">{{ edu.degree }}</div>
                {% if edu.field %}<div class="edu-field">{{ edu.field }}</div>{% endif %}
                <div class="edu-school">{{ edu.school }}</div>
                <div class="edu-year">{{ edu.graduation_date }}</div>
              </div>
            {% endfor %}
          </section>
          {% endif %}
        </aside>

        <!-- RIGHT MAIN CONTENT -->
        <main class="resume-main">
          <!-- Profile -->
          {% if resume.summary %}
          <section class="main-section">
            <h2 class="section-heading"><span class="heading-box">PROFILE</span></h2>
            <p class="profile-text">{{ resume.summary }}</p>
          </section>
          {% endif %}

          <!-- Employment -->
          {% if resume.experience %}
          <section class="main-section">
            <h2 class="section-heading"><span class="heading-box">EMPLOYMENT</span></h2>
            {% for exp in resume.experience %}
              <div class="exp-entry">
                <div class="exp-header">
                  <div class="exp-role">{{ exp.role }}</div>
                  <div class="exp-date">{{ exp.start_date }} - {{ exp.end_date }}</div>
                </div>
                <div class="exp-company">{{ exp.company }}</div>
                {% if exp.bullets %}
                <ul class="exp-bullets">
                  {% for bullet in exp.bullets %}
                    <li>{{ bullet|safe }}</li>
                  {% endfor %}
                </ul>
                {% endif %}
              </div>
            {% endfor %}
          </section>
          {% endif %}
        </main>
      </div>
    </div>
  </div>

  <div style="text-align: center; margin-top: var(--space-6);">
    <a href="{% url 'resume_builder:edit_resume' resume.id %}" class="btn btn-ghost"><i class="fas fa-arrow-left"></i> Back to Editor</a>
  </div>
</div>

<style>
/* Resume Preview Wrapper */
.resume-preview-wrapper {
  display: flex; justify-content: center; padding: var(--space-4);
  background: var(--bg-elevated); border-radius: var(--radius-xl);
}

/* Resume Paper - A4 Size */
.resume-paper {
  width: 210mm; min-height: 297mm; background: #fff; color: #1a1a1a;
  font-family: 'Segoe UI', 'Roboto', Arial, sans-serif; font-size: 10pt;
  line-height: 1.4; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}

/* HEADER */
.resume-header {
  background: var(--primary-color); color: #fff; padding: 30px 40px;
  display: flex; align-items: center; gap: 30px;
}

.header-photo {
  width: 120px; height: 120px; border-radius: 50%; overflow: hidden;
  border: 4px solid rgba(255,255,255,0.3); flex-shrink: 0;
  background: rgba(255,255,255,0.1);
}

.header-photo img { width: 100%; height: 100%; object-fit: cover; }

.photo-placeholder {
  width: 100%; height: 100%; display: flex; align-items: center;
  justify-content: center; font-size: 48px; color: rgba(255,255,255,0.5);
}

.header-info { flex: 1; }

.header-name {
  font-size: 32pt; font-weight: 700; margin: 0 0 4px 0;
  letter-spacing: 3px; color: #fff;
}

.header-role {
  font-size: 14pt; font-weight: 500; margin: 0 0 16px 0;
  color: rgba(255,255,255,0.9);
}

.header-contact { display: flex; flex-direction: column; gap: 6px; }

.contact-item {
  display: flex; align-items: flex-start; gap: 10px;
  font-size: 9.5pt; color: rgba(255,255,255,0.95);
}

.contact-item i { width: 14px; margin-top: 2px; }

/* TWO COLUMN BODY */
.resume-body { display: flex; min-height: calc(297mm - 180px); }

/* LEFT SIDEBAR */
.resume-sidebar {
  width: 200px; background: #f8f9fa; padding: 24px 20px;
  border-right: 1px solid #e5e7eb;
}

.sidebar-section { margin-bottom: 24px; }

.sidebar-heading {
  font-size: 11pt; font-weight: 700; color: #4a9d9a;
  margin: 0 0 12px 0; letter-spacing: 1px;
}

.skills-list {
  list-style: none; margin: 0; padding: 0;
}

.skills-list li {
  font-size: 9.5pt; color: #1a1a1a; padding: 3px 0;
}

.edu-item { margin-bottom: 12px; }
.edu-degree { font-weight: 600; font-size: 9.5pt; color: #1a1a1a; }
.edu-field { font-size: 9pt; color: #555; }
.edu-school { font-size: 9pt; color: #666; }
.edu-year { font-size: 9pt; color: #888; }

/* RIGHT MAIN CONTENT */
.resume-main { flex: 1; padding: 24px 30px; }

.main-section { margin-bottom: 24px; }

.section-heading {
  font-size: 11pt; font-weight: 700; margin: 0 0 12px 0;
}

.heading-box {
  background: var(--primary-color); color: #fff;
  padding: 4px 12px; letter-spacing: 1px;
}

.profile-text {
  font-size: 10pt; color: #333; margin: 0;
  text-align: justify; line-height: 1.5;
}

/* Experience */
.exp-entry { margin-bottom: 20px; }

.exp-header {
  display: flex; justify-content: space-between;
  align-items: baseline; margin-bottom: 2px;
}

.exp-role { font-weight: 700; font-size: 11pt; color: #1a1a1a; }

.exp-date { font-size: 9.5pt; color: #666; }

.exp-company {
  font-size: 10pt; color: var(--primary-color);
  margin-bottom: 8px;
}

.exp-bullets {
  margin: 0; padding-left: 16px;
  list-style-type: disc;
}

.exp-bullets li {
  font-size: 9.5pt; color: #333;
  margin-bottom: 6px; line-height: 1.45;
  text-align: justify;
}

.exp-bullets li:last-child { margin-bottom: 0; }

/* Bold text in bullets */
.exp-bullets li strong, .exp-bullets li b {
  font-weight: 700; color: #1a1a1a;
}

/* Print Styles */
@media print {
  body { background: white !important; }
  .container > div:first-child, .container > div:last-child { display: none !important; }
  .resume-preview-wrapper { padding: 0; background: white; }
  .resume-paper { box-shadow: none; width: 100%; }
}

/* Responsive */
@media (max-width: 900px) {
  .resume-paper { width: 100%; min-height: auto; }
  .resume-header { flex-direction: column; text-align: center; padding: 24px; }
  .header-name { font-size: 24pt; letter-spacing: 1px; }
  .resume-body { flex-direction: column; }
  .resume-sidebar { width: 100%; border-right: none; border-bottom: 1px solid #e5e7eb; }
}
</style>

<script>
// Convert **text** to <strong>text</strong> for bold formatting
document.querySelectorAll('.exp-bullets li').forEach(li => {
  li.innerHTML = li.innerHTML.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
});
</script>
{% endblock %}
