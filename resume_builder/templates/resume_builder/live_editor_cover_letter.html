{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Live Cover Letter Editor CSS -->
<link rel="stylesheet" type="text/css" href="{% static 'css/resume-builder-enhancements.css' %}?v=20260110">
<link rel="stylesheet" type="text/css" href="{% static 'css/live-editor.css' %}?v=20260110">

<div class="live-editor-container">
  <!-- Header -->
  <div class="editor-header">
    <div class="header-content">
      <div class="header-info">
        <h1 class="editor-title">
          <i class="fas fa-envelope"></i>
          Cover Letter Builder
        </h1>
        <p class="editor-subtitle">{{ cover_letter.title }} â€¢ {{ cover_letter.template.name }}</p>
      </div>
      <div class="header-actions">
        <button id="autoSaveToggle" class="btn btn-ghost btn-sm">
          <i class="fas fa-save"></i>
          <span id="autoSaveStatus">Auto-save: On</span>
        </button>
        <button id="saveCoverLetter" class="btn btn-secondary">
          <i class="fas fa-save"></i>
          Save
        </button>
        <a href="{% url 'resume_builder:download_cover_letter' cover_letter.id %}" class="btn btn-primary" target="_blank">
          <i class="fas fa-file-pdf"></i>
          Download PDF
        </a>
        <a href="{% url 'resume_builder:dashboard' %}" class="btn btn-ghost">
          <i class="fas fa-arrow-left"></i>
          Back
        </a>
      </div>
    </div>
  </div>

  <!-- Split Layout Editor -->
  <div class="editor-layout">
    <!-- Left Panel - Editor -->
    <div class="editor-panel">
      <div class="panel-header">
        <h2>
          <i class="fas fa-edit"></i>
          Edit Cover Letter
        </h2>
        <div class="panel-controls">
          <button class="btn btn-ghost btn-sm" id="collapseAllSections">
            <i class="fas fa-compress-alt"></i>
            Collapse All
          </button>
        </div>
      </div>

      <form id="coverLetterForm" class="editor-form">
        {% csrf_token %}
        
        <!-- Personal Details Section -->
        <div class="form-section" data-section="personal">
          <div class="section-header">
            <h3>
              <i class="fas fa-user"></i>
              Personal Details
            </h3>
            <button type="button" class="section-toggle">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>
          <div class="section-content">
            <div class="form-grid">
              <div class="form-group">
                <label for="full_name">Full Name *</label>
                <input type="text" id="full_name" name="full_name" value="{{ cover_letter.full_name }}" required>
              </div>
              <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" value="{{ cover_letter.email }}" required>
              </div>
              <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" id="phone" name="phone" value="{{ cover_letter.phone }}">
              </div>
              <div class="form-group">
                <label for="location">Location</label>
                <input type="text" id="location" name="location" value="{{ cover_letter.location }}">
              </div>
            </div>
          </div>
        </div>

        <!-- Company Information Section -->
        <div class="form-section" data-section="company">
          <div class="section-header">
            <h3>
              <i class="fas fa-building"></i>
              Company Information
            </h3>
            <button type="button" class="section-toggle">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>
          <div class="section-content">
            <div class="form-grid">
              <div class="form-group">
                <label for="company_name">Company Name *</label>
                <input type="text" id="company_name" name="company_name" value="{{ cover_letter.company_name }}" required>
              </div>
              <div class="form-group">
                <label for="position_title">Position Title *</label>
                <input type="text" id="position_title" name="position_title" value="{{ cover_letter.position_title }}" required>
              </div>
              <div class="form-group">
                <label for="hiring_manager">Hiring Manager</label>
                <input type="text" id="hiring_manager" name="hiring_manager" value="{{ cover_letter.hiring_manager }}" placeholder="e.g., John Smith">
              </div>
            </div>
          </div>
        </div>

        <!-- Cover Letter Content Section -->
        <div class="form-section" data-section="content">
          <div class="section-header">
            <h3>
              <i class="fas fa-edit"></i>
              Letter Content
            </h3>
            <button type="button" class="section-toggle">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>
          <div class="section-content">
            <div class="form-group">
              <label for="content">Cover Letter Content *</label>
              <textarea id="content" name="content" rows="15" required placeholder="Write your cover letter content here...">{{ cover_letter.content }}</textarea>
              <div class="field-hint">
                <i class="fas fa-lightbulb"></i>
                Tip: Customize your letter for each application. Mention specific achievements and explain why you're interested in this role and company.
              </div>
              <div class="content-stats">
                <span class="char-count">0 characters</span>
                <span class="word-count">0 words</span>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- Right Panel - Live Preview -->
    <div class="preview-panel">
      <div class="panel-header">
        <h2>
          <i class="fas fa-eye"></i>
          Live Preview
        </h2>
        <div class="panel-controls">
          <button class="btn btn-ghost btn-sm" id="zoomOut">
            <i class="fas fa-search-minus"></i>
          </button>
          <span class="zoom-level">100%</span>
          <button class="btn btn-ghost btn-sm" id="zoomIn">
            <i class="fas fa-search-plus"></i>
          </button>
          <button class="btn btn-ghost btn-sm" id="fullscreenPreview">
            <i class="fas fa-expand"></i>
          </button>
        </div>
      </div>
      
      <div class="preview-container">
        <div class="preview-document" id="coverLetterPreview">
          <!-- Live preview will be rendered here -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Auto-save Status -->
<div id="saveStatus" class="save-status">
  <i class="fas fa-check-circle"></i>
  <span>All changes saved</span>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const coverLetterEditor = new CoverLetterEditor({
    coverLetterId: {{ cover_letter.id }},
    templateId: {{ cover_letter.template.id }},
    autoSave: true,
    autoSaveInterval: 2000
  });
});
</script>

<script src="{% static 'js/live-editor-cover-letter.js' %}?v=20260110"></script>
{% endblock %}