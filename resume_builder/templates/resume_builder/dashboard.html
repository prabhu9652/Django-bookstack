{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Hidden CSRF token for form submissions -->
{% csrf_token %}

<div class="container p-8">
  <!-- Clean Header -->
  <div class="dashboard-header d-flex justify-content-between align-items-center mb-12 animate-slide-down">
    <div class="header-content">
      <h1 class="d-flex align-items-center gap-3 mb-2">
        <div class="header-icon">
          <i class="fas fa-folder-open"></i>
        </div>
        My Documents
      </h1>
      <p class="text-secondary">
        Manage your professional resumes and cover letters
      </p>
    </div>
    <div class="header-actions d-flex gap-3">
      <a href="{% url 'resume_builder:resume_templates' %}" class="btn btn-primary animate-slide-right">
        <i class="fas fa-plus"></i>
        New Resume
      </a>
      <a href="{% url 'resume_builder:cover_letter_templates' %}" class="btn btn-secondary animate-slide-right">
        <i class="fas fa-plus"></i>
        New Cover Letter
      </a>
    </div>
  </div>

  <!-- Resumes Section -->
  <div class="documents-section mb-16 animate-slide-left">
    <div class="section-header-enhanced mb-8">
      <h2 class="d-flex align-items-center">
        <div class="section-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        Resumes
      </h2>
      {% if resumes %}
        <span class="document-count">
          {{ resumes|length }} document{{ resumes|length|pluralize }}
        </span>
      {% endif %}
    </div>
    
    {% if resumes %}
      <div class="documents-grid-enhanced">
        {% for resume in resumes %}
          <div class="document-card-enhanced animate-slide-up animate-stagger-{{ forloop.counter0|add:1 }}" data-document-id="{{ resume.id }}" data-document-type="resume">
            <!-- Card Header -->
            <div class="card-header-section">
              <div class="document-type-badge resume-badge">
                <i class="fas fa-file-alt"></i>
                Resume
              </div>
              <div class="document-status-badge">
                <i class="fas fa-check-circle"></i>
                Ready
              </div>
            </div>
            
            <!-- Card Body -->
            <div class="card-body-section">
              <h3 class="document-title-enhanced">{{ resume.title }}</h3>
              <div class="document-meta-enhanced">
                <div class="meta-row">
                  <i class="fas fa-palette"></i>
                  <span>{{ resume.template.name }}</span>
                </div>
                <div class="meta-row">
                  <i class="fas fa-clock"></i>
                  <span>Updated {{ resume.updated_at|date:"M d, Y" }}</span>
                </div>
              </div>
            </div>
            
            <!-- Card Actions -->
            <div class="card-actions-section">
              <div class="primary-actions-row">
                <a href="{% url 'resume_builder:edit_resume' resume.id %}" class="action-btn-enhanced primary-action">
                  <i class="fas fa-edit"></i>
                  Edit
                </a>
                <a href="{% url 'resume_builder:preview_resume' resume.id %}" class="action-btn-enhanced secondary-action">
                  <i class="fas fa-eye"></i>
                  Preview
                </a>
              </div>
              <div class="secondary-actions-row">
                <a href="{% url 'resume_builder:download_resume' resume.id %}" class="icon-action-btn download-action" title="Download PDF">
                  <i class="fas fa-file-pdf"></i>
                </a>
                <button type="button" class="icon-action-btn delete-action delete-document-btn" 
                        data-document-id="{{ resume.id }}" 
                        data-document-type="resume" 
                        data-document-title="{{ resume.title }}"
                        title="Delete Resume">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-icon animate-pulse">
          <i class="fas fa-file-alt"></i>
        </div>
        <h3>No resumes yet</h3>
        <p>Create your first professional resume to get started on your career journey.</p>
        <a href="{% url 'resume_builder:resume_templates' %}" class="btn btn-primary btn-lg">
          <i class="fas fa-plus"></i>
          Create Your First Resume
        </a>
      </div>
    {% endif %}
  </div>

  <!-- Cover Letters Section -->
  <div class="documents-section animate-slide-right">
    <div class="section-header-enhanced mb-8">
      <h2 class="d-flex align-items-center">
        <div class="section-icon">
          <i class="fas fa-envelope"></i>
        </div>
        Cover Letters
      </h2>
      {% if cover_letters %}
        <span class="document-count">
          {{ cover_letters|length }} document{{ cover_letters|length|pluralize }}
        </span>
      {% endif %}
    </div>
    
    {% if cover_letters %}
      <div class="documents-grid-enhanced">
        {% for cover_letter in cover_letters %}
          <div class="document-card-enhanced animate-slide-up animate-stagger-{{ forloop.counter0|add:1 }}" data-document-id="{{ cover_letter.id }}" data-document-type="cover_letter">
            <!-- Card Header -->
            <div class="card-header-section">
              <div class="document-type-badge letter-badge">
                <i class="fas fa-envelope"></i>
                Cover Letter
              </div>
              <div class="document-status-badge">
                <i class="fas fa-check-circle"></i>
                Ready
              </div>
            </div>
            
            <!-- Card Body -->
            <div class="card-body-section">
              <h3 class="document-title-enhanced">{{ cover_letter.title }}</h3>
              <div class="document-meta-enhanced">
                <div class="meta-row">
                  <i class="fas fa-building"></i>
                  <span>{{ cover_letter.company_name }}</span>
                </div>
                <div class="meta-row">
                  <i class="fas fa-palette"></i>
                  <span>{{ cover_letter.template.name }}</span>
                </div>
                <div class="meta-row">
                  <i class="fas fa-clock"></i>
                  <span>Updated {{ cover_letter.updated_at|date:"M d, Y" }}</span>
                </div>
              </div>
            </div>
            
            <!-- Card Actions -->
            <div class="card-actions-section">
              <div class="primary-actions-row">
                <a href="{% url 'resume_builder:edit_cover_letter' cover_letter.id %}" class="action-btn-enhanced primary-action">
                  <i class="fas fa-edit"></i>
                  Edit
                </a>
                <a href="{% url 'resume_builder:preview_cover_letter' cover_letter.id %}" class="action-btn-enhanced secondary-action">
                  <i class="fas fa-eye"></i>
                  Preview
                </a>
              </div>
              <div class="secondary-actions-row">
                <a href="{% url 'resume_builder:download_cover_letter' cover_letter.id %}" class="icon-action-btn download-action" title="Download PDF">
                  <i class="fas fa-file-pdf"></i>
                </a>
                <button type="button" class="icon-action-btn delete-action delete-document-btn" 
                        data-document-id="{{ cover_letter.id }}" 
                        data-document-type="cover_letter" 
                        data-document-title="{{ cover_letter.title }}"
                        title="Delete Cover Letter">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-icon animate-pulse">
          <i class="fas fa-envelope"></i>
        </div>
        <h3>No cover letters yet</h3>
        <p>Create your first cover letter to complement your resume and make a great impression.</p>
        <a href="{% url 'resume_builder:cover_letter_templates' %}" class="btn btn-primary btn-lg">
          <i class="fas fa-plus"></i>
          Create Your First Cover Letter
        </a>
      </div>
    {% endif %}
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="delete-modal-overlay">
  <div class="delete-modal-content">
    <div class="delete-modal-header">
      <div class="delete-modal-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3>Delete Document</h3>
      <p id="deleteMessage">Are you sure you want to delete this document? This action cannot be undone.</p>
    </div>
    
    <div class="delete-modal-actions">
      <button id="cancelDelete" class="modal-btn cancel-btn">
        <i class="fas fa-times"></i>
        Cancel
      </button>
      <button id="confirmDelete" class="modal-btn confirm-delete-btn">
        <i class="fas fa-trash"></i>
        Delete Document
      </button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Enhanced card hover effects
  function setupCardEffects() {
    const cards = document.querySelectorAll('.document-card-enhanced');
    
    cards.forEach(card => {
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-6px)';
        card.style.boxShadow = '0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.08)';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0)';
        card.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)';
      });
    });
  }
  
  // Delete functionality with confirmation modal
  function setupDeleteFunctionality() {
    const modal = document.getElementById('deleteModal');
    const deleteMessage = document.getElementById('deleteMessage');
    const cancelBtn = document.getElementById('cancelDelete');
    const confirmBtn = document.getElementById('confirmDelete');
    let currentDeleteData = null;
    
    function showModal(documentData) {
      currentDeleteData = documentData;
      const docType = documentData.type === 'resume' ? 'resume' : 'cover letter';
      deleteMessage.textContent = `Are you sure you want to delete "${documentData.title}"? This ${docType} will be permanently removed and cannot be recovered.`;
      
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }
    
    function hideModal() {
      modal.classList.remove('show');
      document.body.style.overflow = '';
      currentDeleteData = null;
    }
    
    function deleteDocument(documentData) {
      const card = document.querySelector(`[data-document-id="${documentData.id}"][data-document-type="${documentData.type}"]`);
      
      if (card) {
        card.style.transform = 'scale(0.9)';
        card.style.opacity = '0';
        card.style.transition = 'all 0.2s ease-out';
        
        setTimeout(() => {
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = documentData.type === 'resume' 
            ? `/resume-builder/delete-resume/${documentData.id}/`
            : `/resume-builder/delete-cover-letter/${documentData.id}/`;
          
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                           document.querySelector('meta[name=csrf-token]')?.content;
          
          if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken;
            form.appendChild(csrfInput);
          }
          
          document.body.appendChild(form);
          form.submit();
        }, 200);
      }
    }
    
    document.addEventListener('click', (e) => {
      if (e.target.closest('.delete-document-btn')) {
        e.preventDefault();
        e.stopPropagation();
        const btn = e.target.closest('.delete-document-btn');
        const documentData = {
          id: btn.dataset.documentId,
          type: btn.dataset.documentType,
          title: btn.dataset.documentTitle
        };
        showModal(documentData);
      }
    });
    
    cancelBtn.addEventListener('click', hideModal);
    
    confirmBtn.addEventListener('click', () => {
      if (currentDeleteData) {
        const dataToDelete = {...currentDeleteData};
        hideModal();
        setTimeout(() => deleteDocument(dataToDelete), 50);
      }
    });
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('show')) {
        hideModal();
      }
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        hideModal();
      }
    });
  }
  
  setupCardEffects();
  setupDeleteFunctionality();
});
</script>

<style>
/* Enhanced Document Card Styles */
.header-icon {
  width: 56px;
  height: 56px;
  background: var(--accent-subtle);
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
}

.header-icon i {
  color: var(--accent-primary);
  font-size: var(--font-size-xl);
}

.section-header-enhanced {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.section-icon {
  width: 48px;
  height: 48px;
  background: var(--accent-subtle);
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: var(--space-4);
}

.section-icon i {
  color: var(--accent-primary);
  font-size: var(--font-size-lg);
}

.document-count {
  background: var(--accent-subtle);
  color: var(--accent-primary);
  padding: var(--space-2) var(--space-4);
  border-radius: var(--radius-full);
  font-size: var(--font-size-sm);
  font-weight: 600;
}

.documents-grid-enhanced {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: var(--space-6);
}

/* Enhanced Document Card */
.document-card-enhanced {
  background: var(--bg-surface);
  border: 1px solid var(--border-default);
  border-radius: var(--radius-xl);
  overflow: hidden;
  transition: all 0.3s ease-out;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.document-card-enhanced:hover {
  border-color: var(--accent-primary);
}

.card-header-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-4) var(--space-5);
  background: var(--bg-elevated);
  border-bottom: 1px solid var(--border-default);
}

.document-type-badge {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-md);
  font-size: var(--font-size-xs);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.document-type-badge.resume-badge {
  background: rgba(59, 130, 246, 0.1);
  color: #3b82f6;
}

.document-type-badge.letter-badge {
  background: rgba(139, 92, 246, 0.1);
  color: #8b5cf6;
}

.document-status-badge {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-1) var(--space-3);
  background: rgba(34, 197, 94, 0.1);
  color: #22c55e;
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: 600;
}

.card-body-section {
  padding: var(--space-5);
}

.document-title-enhanced {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-4);
  line-height: 1.3;
}

.document-meta-enhanced {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.meta-row {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  color: var(--text-secondary);
  font-size: var(--font-size-sm);
}

.meta-row i {
  width: 16px;
  color: var(--text-muted);
}

.card-actions-section {
  padding: var(--space-4) var(--space-5);
  background: var(--bg-elevated);
  border-top: 1px solid var(--border-default);
}

.primary-actions-row {
  display: flex;
  gap: var(--space-3);
  margin-bottom: var(--space-4);
}

.action-btn-enhanced {
  flex: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-4);
  border-radius: var(--radius-lg);
  font-size: var(--font-size-sm);
  font-weight: 600;
  text-decoration: none;
  transition: all 0.2s ease-out;
  cursor: pointer;
  border: none;
}

.action-btn-enhanced.primary-action {
  background: linear-gradient(135deg, var(--accent-primary), #2563eb);
  color: white;
}

.action-btn-enhanced.primary-action:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.action-btn-enhanced.secondary-action {
  background: var(--bg-surface);
  color: var(--text-primary);
  border: 1px solid var(--border-default);
}

.action-btn-enhanced.secondary-action:hover {
  background: var(--bg-elevated);
  border-color: var(--accent-primary);
}

.secondary-actions-row {
  display: flex;
  justify-content: flex-end;
  gap: var(--space-2);
  padding-top: var(--space-3);
  border-top: 1px solid var(--border-default);
}

.icon-action-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: var(--radius-lg);
  background: var(--bg-surface);
  border: 1px solid var(--border-default);
  color: var(--text-secondary);
  text-decoration: none;
  transition: all 0.2s ease-out;
  cursor: pointer;
}

.icon-action-btn.download-action:hover {
  background: rgba(34, 197, 94, 0.1);
  border-color: #22c55e;
  color: #22c55e;
  transform: translateY(-2px);
}

.icon-action-btn.delete-action {
  color: var(--error);
}

.icon-action-btn.delete-action:hover {
  background: rgba(239, 68, 68, 0.1);
  border-color: var(--error);
  transform: translateY(-2px);
}

/* Delete Modal Styles */
.delete-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.15s ease-out;
}

.delete-modal-overlay.show {
  opacity: 1;
  visibility: visible;
}

.delete-modal-content {
  background: var(--bg-surface);
  border: 1px solid var(--border-default);
  border-radius: var(--radius-2xl);
  padding: var(--space-8);
  max-width: 420px;
  width: 90%;
  transform: scale(0.95) translateY(10px);
  transition: all 0.15s ease-out;
}

.delete-modal-overlay.show .delete-modal-content {
  transform: scale(1) translateY(0);
}

.delete-modal-header {
  text-align: center;
  margin-bottom: var(--space-6);
}

.delete-modal-icon {
  width: 72px;
  height: 72px;
  background: rgba(239, 68, 68, 0.1);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto var(--space-4);
}

.delete-modal-icon i {
  font-size: var(--font-size-2xl);
  color: var(--error);
}

.delete-modal-header h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: var(--space-3);
}

.delete-modal-header p {
  color: var(--text-secondary);
  font-size: var(--font-size-sm);
  line-height: 1.5;
}

.delete-modal-actions {
  display: flex;
  gap: var(--space-3);
}

.modal-btn {
  flex: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  padding: var(--space-4);
  border-radius: var(--radius-lg);
  font-size: var(--font-size-sm);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease-out;
  border: none;
}

.modal-btn.cancel-btn {
  background: var(--bg-elevated);
  color: var(--text-primary);
  border: 1px solid var(--border-default);
}

.modal-btn.cancel-btn:hover {
  background: var(--bg-surface);
}

.modal-btn.confirm-delete-btn {
  background: linear-gradient(135deg, #ef4444, #dc2626);
  color: white;
}

.modal-btn.confirm-delete-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

/* Responsive */
@media (max-width: 768px) {
  .documents-grid-enhanced {
    grid-template-columns: 1fr;
  }
  
  .dashboard-header {
    flex-direction: column;
    gap: var(--space-4);
    text-align: center;
  }
  
  .header-actions {
    flex-direction: column;
    width: 100%;
  }
  
  .section-header-enhanced {
    flex-direction: column;
    gap: var(--space-3);
    text-align: center;
  }
  
  .primary-actions-row {
    flex-direction: column;
  }
  
  .delete-modal-actions {
    flex-direction: column;
  }
}
</style>
{% endblock %}