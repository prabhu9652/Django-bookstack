{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container p-8">
  <!-- Clean Header -->
  <div class="dashboard-header d-flex justify-content-between align-items-center mb-12 animate-slide-down">
    <div class="header-content">
      <h1 class="d-flex align-items-center gap-3 mb-2">
        <div class="header-icon">
          <i class="fas fa-folder-open"></i>
        </div>
        My Documents
      </h1>
      <p class="text-secondary">
        Manage your professional resumes and cover letters
      </p>
    </div>
    <div class="header-actions d-flex gap-3">
      <a href="{% url 'resume_builder:resume_templates' %}" class="btn btn-primary animate-slide-right">
        <i class="fas fa-plus"></i>
        New Resume
      </a>
      <a href="{% url 'resume_builder:cover_letter_templates' %}" class="btn btn-secondary animate-slide-right">
        <i class="fas fa-plus"></i>
        New Cover Letter
      </a>
    </div>
  </div>

  <!-- Resumes Section -->
  <div class="documents-section mb-16 animate-slide-left">
    <div class="resume-header mb-8">
      <h2 class="d-flex align-items-center">
        <div class="section-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        Resumes
      </h2>
      {% if resumes %}
        <span class="document-count">
          {{ resumes|length }} document{{ resumes|length|pluralize }}
        </span>
      {% endif %}
    </div>
    
    {% if resumes %}
      <div class="documents-grid">
        {% for resume in resumes %}
          <div class="document-card resume-card animate-slide-up animate-stagger-{{ forloop.counter0|add:1 }}" data-document-id="{{ resume.id }}" data-document-type="resume">
            
            <div class="document-content">
              <!-- Document Header -->
              <div class="document-header d-flex justify-content-between align-items-start mb-5">
                <div class="document-info">
                  <h3 class="document-title">
                    {{ resume.title }}
                  </h3>
                  <div class="document-meta d-flex flex-column gap-2">
                    <div class="meta-item d-flex align-items-center gap-2">
                      <i class="fas fa-palette"></i>
                      <span>{{ resume.template.name }}</span>
                    </div>
                    <div class="meta-item d-flex align-items-center gap-2">
                      <i class="fas fa-clock"></i>
                      <span>Updated {{ resume.updated_at|date:"M d, Y" }}</span>
                    </div>
                  </div>
                </div>
                
                <!-- Status Badge -->
                <div class="document-status">
                  <i class="fas fa-check-circle"></i>
                  Ready
                </div>
              </div>
              
              <!-- Action Buttons -->
              <div class="document-actions">
                <a href="{% url 'resume_builder:edit_resume' resume.id %}" class="btn btn-primary">
                  <i class="fas fa-edit"></i>
                  Edit
                </a>
                <a href="{% url 'resume_builder:preview_resume' resume.id %}" class="btn btn-secondary">
                  <i class="fas fa-eye"></i>
                  Preview
                </a>
              </div>
              
              <!-- Secondary Actions -->
              <div class="secondary-actions d-flex justify-content-between align-items-center">
                <a href="{% url 'resume_builder:download_resume' resume.id %}" class="secondary-btn">
                  <i class="fas fa-download"></i>
                  Download
                </a>
                <button type="button" class="secondary-btn delete-document-btn" data-document-id="{{ resume.id }}" data-document-type="resume" data-document-title="{{ resume.title }}">
                  <i class="fas fa-trash"></i>
                  Delete
                </button>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-icon animate-pulse">
          <i class="fas fa-file-alt"></i>
        </div>
        <h3>No resumes yet</h3>
        <p>Create your first professional resume to get started on your career journey.</p>
        <a href="{% url 'resume_builder:resume_templates' %}" class="btn btn-primary btn-lg">
          <i class="fas fa-plus"></i>
          Create Your First Resume
        </a>
      </div>
    {% endif %}
  </div>

  <!-- Cover Letters Section -->
  <div class="documents-section animate-slide-right">
    <div class="resume-header mb-8">
      <h2 class="d-flex align-items-center">
        <div class="section-icon">
          <i class="fas fa-envelope"></i>
        </div>
        Cover Letters
      </h2>
      {% if cover_letters %}
        <span class="document-count">
          {{ cover_letters|length }} document{{ cover_letters|length|pluralize }}
        </span>
      {% endif %}
    </div>
    
    {% if cover_letters %}
      <div class="documents-grid">
        {% for cover_letter in cover_letters %}
          <div class="document-card cover-letter-card animate-slide-up animate-stagger-{{ forloop.counter0|add:1 }}" data-document-id="{{ cover_letter.id }}" data-document-type="cover_letter">
            
            <div class="document-header d-flex justify-content-between align-items-start mb-4">
              <div class="document-info">
                <h3 class="document-title">
                  {{ cover_letter.title }}
                </h3>
                <div class="document-meta d-flex flex-column gap-1">
                  <p class="d-flex align-items-center gap-2">
                    <i class="fas fa-building"></i>
                    {{ cover_letter.company_name }}
                  </p>
                  <p class="d-flex align-items-center gap-2">
                    <i class="fas fa-palette"></i>
                    {{ cover_letter.template.name }}
                  </p>
                  <p class="d-flex align-items-center gap-2">
                    <i class="fas fa-clock"></i>
                    Updated {{ cover_letter.updated_at|date:"M d, Y" }}
                  </p>
                </div>
              </div>
              
              <!-- Direct Action Icons -->
              <div class="document-actions-direct d-flex align-items-center gap-2">
                <a href="{% url 'resume_builder:edit_cover_letter' cover_letter.id %}" class="action-icon edit-action" title="Edit Cover Letter">
                  <i class="fas fa-edit"></i>
                </a>
                <a href="{% url 'resume_builder:preview_cover_letter' cover_letter.id %}" class="action-icon view-action" title="Preview Cover Letter">
                  <i class="fas fa-eye"></i>
                </a>
                <a href="{% url 'resume_builder:download_cover_letter' cover_letter.id %}" class="action-icon download-action" title="Download Cover Letter">
                  <i class="fas fa-download"></i>
                </a>
                <button type="button" class="action-icon delete-action delete-document-btn" data-document-id="{{ cover_letter.id }}" data-document-type="cover_letter" data-document-title="{{ cover_letter.title }}" title="Delete Cover Letter">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            
            <!-- Document Status -->
            <div class="document-status d-flex align-items-center gap-3">
              <div class="status-indicator">
                <i class="fas fa-check-circle"></i>
                Ready
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-icon animate-pulse">
          <i class="fas fa-envelope"></i>
        </div>
        <h3>No cover letters yet</h3>
        <p>Create your first cover letter to complement your resume and make a great impression.</p>
        <a href="{% url 'resume_builder:cover_letter_templates' %}" class="btn btn-primary btn-lg">
          <i class="fas fa-plus"></i>
          Create Your First Cover Letter
        </a>
      </div>
    {% endif %}
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <div class="modal-header text-center mb-6">
      <div class="modal-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3>Delete Document</h3>
      <p id="deleteMessage">Are you sure you want to delete this document? This action cannot be undone.</p>
    </div>
    
    <div class="modal-actions d-flex gap-3 justify-content-center">
      <button id="cancelDelete" class="btn btn-secondary">
        <i class="fas fa-times"></i>
        Cancel
      </button>
      <button id="confirmDelete" class="btn btn-danger">
        <i class="fas fa-trash"></i>
        Delete Document
      </button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Enhanced card hover effects with direct actions
  function setupCardEffects() {
    const cards = document.querySelectorAll('.document-card');
    
    cards.forEach(card => {
      const overlay = card.querySelector('.card-overlay');
      const actionsContainer = card.querySelector('.document-actions-direct');
      
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-8px) scale(1.02)';
        card.style.borderColor = 'var(--accent-primary)';
        card.style.boxShadow = 'var(--shadow-lg), var(--glow-subtle)';
        if (overlay) overlay.style.opacity = '0.1';
        if (actionsContainer) actionsContainer.style.opacity = '1';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0) scale(1)';
        card.style.borderColor = 'var(--border-primary)';
        card.style.boxShadow = 'none';
        if (overlay) overlay.style.opacity = '0';
        if (actionsContainer) actionsContainer.style.opacity = '0.8';
      });
    });
  }
  
  // Enhanced action icon hover effects
  function setupActionIconEffects() {
    const actionIcons = document.querySelectorAll('.action-icon');
    
    actionIcons.forEach(icon => {
      icon.addEventListener('mouseenter', () => {
        icon.style.transform = 'translateY(-2px) scale(1.1)';
        icon.style.boxShadow = 'var(--shadow-md)';
        
        // Specific hover colors
        if (icon.classList.contains('edit-action')) {
          icon.style.background = 'var(--accent-subtle)';
          icon.style.borderColor = 'var(--accent-primary)';
        } else if (icon.classList.contains('view-action')) {
          icon.style.background = 'var(--info-subtle)';
          icon.style.borderColor = 'var(--info)';
          icon.style.color = 'var(--info)';
        } else if (icon.classList.contains('download-action')) {
          icon.style.background = 'var(--success-subtle)';
          icon.style.borderColor = 'var(--success)';
          icon.style.color = 'var(--success)';
        } else if (icon.classList.contains('delete-action')) {
          icon.style.background = 'rgba(239, 68, 68, 0.1)';
          icon.style.borderColor = 'var(--error)';
        }
      });
      
      icon.addEventListener('mouseleave', () => {
        icon.style.transform = 'translateY(0) scale(1)';
        icon.style.boxShadow = 'var(--shadow-sm)';
        icon.style.background = 'var(--bg-elevated)';
        icon.style.borderColor = 'var(--border-primary)';
        
        // Reset colors
        if (icon.classList.contains('edit-action')) {
          icon.style.color = 'var(--accent-primary)';
        } else if (icon.classList.contains('view-action') || icon.classList.contains('download-action')) {
          icon.style.color = 'var(--text-secondary)';
        } else if (icon.classList.contains('delete-action')) {
          icon.style.color = 'var(--error)';
        }
      });
      
      // Add click feedback
      icon.addEventListener('click', () => {
        icon.style.transform = 'translateY(0) scale(1.05)';
        setTimeout(() => {
          icon.style.transform = 'translateY(-2px) scale(1.1)';
        }, 100);
      });
    });
  }
  
  // Delete functionality with confirmation modal
  function setupDeleteFunctionality() {
    const modal = document.getElementById('deleteModal');
    const deleteMessage = document.getElementById('deleteMessage');
    const cancelBtn = document.getElementById('cancelDelete');
    const confirmBtn = document.getElementById('confirmDelete');
    let currentDeleteData = null;
    
    // Show modal with enhanced animation
    function showModal(documentData) {
      currentDeleteData = documentData;
      const docType = documentData.type === 'resume' ? 'resume' : 'cover letter';
      deleteMessage.textContent = `Are you sure you want to delete "${documentData.title}"? This ${docType} will be permanently removed and cannot be recovered.`;
      
      modal.style.display = 'block';
      setTimeout(() => {
        modal.style.opacity = '1';
        modal.querySelector('.modal-content').style.transform = 'translate(-50%, -50%) scale(1)';
      }, 10);
    }
    
    // Hide modal with animation
    function hideModal() {
      modal.style.opacity = '0';
      modal.querySelector('.modal-content').style.transform = 'translate(-50%, -50%) scale(0.9)';
      setTimeout(() => {
        modal.style.display = 'none';
        currentDeleteData = null;
      }, 300);
    }
    
    // Delete document with enhanced animation
    function deleteDocument(documentData) {
      const card = document.querySelector(`[data-document-id="${documentData.id}"][data-document-type="${documentData.type}"]`);
      
      if (card) {
        // Enhanced removal animation
        card.style.transform = 'scale(0.8) rotateX(90deg)';
        card.style.opacity = '0';
        card.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
        
        setTimeout(() => {
          // Create and submit form
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = documentData.type === 'resume' 
            ? `/resume-builder/delete-resume/${documentData.id}/`
            : `/resume-builder/delete-cover-letter/${documentData.id}/`;
          
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                           document.querySelector('meta[name=csrf-token]')?.content;
          
          if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken;
            form.appendChild(csrfInput);
          }
          
          document.body.appendChild(form);
          form.submit();
        }, 400);
      }
    }
    
    // Event listeners
    document.addEventListener('click', (e) => {
      if (e.target.closest('.delete-document-btn')) {
        e.preventDefault();
        const btn = e.target.closest('.delete-document-btn');
        const documentData = {
          id: btn.dataset.documentId,
          type: btn.dataset.documentType,
          title: btn.dataset.documentTitle
        };
        showModal(documentData);
      }
    });
    
    cancelBtn.addEventListener('click', hideModal);
    
    confirmBtn.addEventListener('click', () => {
      if (currentDeleteData) {
        hideModal();
        setTimeout(() => deleteDocument(currentDeleteData), 100);
      }
    });
    
    // Close modal on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.style.display === 'block') {
        hideModal();
      }
    });
    
    // Close modal on backdrop click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        hideModal();
      }
    });
  }
  
  // Initialize all functionality
  setupCardEffects();
  setupActionIconEffects();
  setupDeleteFunctionality();
});
</script>

<style>
/* Resume Builder Dashboard Styles */
.header-icon {
  width: 56px;
  height: 56px;
  background: var(--accent-subtle);
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
}

.header-icon i {
  color: var(--accent-primary);
  font-size: var(--font-size-xl);
}

.section-icon {
  width: 48px;
  height: 48px;
  background: var(--accent-subtle);
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: var(--space-4);
}

.section-icon i {
  color: var(--accent-primary);
  font-size: var(--font-size-lg);
}

.document-count {
  background: var(--accent-subtle);
  color: var(--accent-primary);
  padding: var(--space-2) var(--space-4);
  border-radius: var(--radius-full);
  font-size: var(--font-size-sm);
  font-weight: 600;
}

.documents-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
  gap: var(--space-8);
}

.action-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: var(--radius-lg);
  background: var(--bg-elevated);
  border: 1px solid var(--border-default);
  transition: all var(--transition-fast);
  text-decoration: none;
}

.action-icon.edit-action {
  color: var(--accent-primary);
}

.action-icon.view-action,
.action-icon.download-action {
  color: var(--text-secondary);
}

.action-icon.delete-action {
  color: var(--error);
  background: none;
  border: none;
  cursor: pointer;
}

.status-indicator {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-3);
  background: var(--success-subtle);
  color: var(--success);
  border-radius: var(--radius-md);
  font-size: var(--font-size-xs);
  font-weight: 600;
}

.secondary-btn {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  color: var(--text-secondary);
  font-size: var(--font-size-sm);
  text-decoration: none;
  transition: color var(--transition-fast);
  background: none;
  border: none;
  cursor: pointer;
}

.secondary-btn.delete-document-btn {
  color: var(--error);
}

.modal-icon {
  width: 80px;
  height: 80px;
  background: var(--error-subtle);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto var(--space-4);
}

.modal-icon i {
  font-size: var(--font-size-3xl);
  color: var(--error);
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .documents-grid {
    grid-template-columns: 1fr !important;
  }
  
  .dashboard-header {
    flex-direction: column !important;
    gap: var(--space-4) !important;
    text-align: center !important;
  }
  
  .resume-header {
    flex-direction: column !important;
    gap: var(--space-3) !important;
    text-align: center !important;
  }
}

@media (max-width: 480px) {
  .document-actions {
    flex-direction: column !important;
  }
  
  .modal-content {
    width: 95% !important;
    padding: var(--space-6) !important;
  }
  
  .modal-actions {
    flex-direction: column !important;
  }
}
</style>
    flex-direction: column !important;
  }
}
</style>
{% endblock %}